<!--
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë  ML 4.11 - Multiplying a One-Digit Number by Multiples of Ten                ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë  Concept: 4 √ó 30 = 4 groups of 3 groups of 10 = 4 √ó 3 √ó 10 = 12 tens = 120  ‚ïë
‚ïë  Visual: Boxes labeled "10" arranged in rows (like Amplify curriculum)       ‚ïë
‚ïë  Standards: NY-3.OA.5, 7 (Associative property, multiplying by 10)          ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>üîü Tens Takeover!</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Bangers&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Fredoka', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        #game-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            min-height: calc(100vh - 20px);
        }

        /* ========== HEADER ========== */
        #header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            margin-bottom: 10px;
        }

        #title {
            font-family: 'Bangers', cursive;
            font-size: 24px;
            color: white;
        }

        #stats {
            display: flex;
            gap: 15px;
            align-items: flex-start;
        }

        .stat {
            text-align: center;
            padding: 5px 12px;
            border-radius: 8px;
        }

        .stat-label {
            font-size: 10px;
            color: rgba(255,255,255,0.8);
            text-transform: uppercase;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #ffd93d;
        }

        .streak-display {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .streak-display.hot {
            background: linear-gradient(135deg, #f39c12, #e74c3c);
            animation: pulse 0.5s ease infinite alternate;
        }

        @keyframes pulse {
            to { transform: scale(1.05); }
        }

        /* Difficulty display */
        #difficulty-display {
            background: linear-gradient(135deg, #81c784, #4caf50);
            transition: all 0.3s ease;
        }

        #difficulty-display.hard {
            background: linear-gradient(135deg, #ff9800, #f57c00);
        }

        #difficulty-display.superhard {
            background: linear-gradient(135deg, #e91e63, #9c27b0);
            animation: pulse 0.5s ease infinite alternate;
        }

        @keyframes levelUp {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }

        #difficulty-display.level-up {
            animation: levelUp 0.5s ease;
        }

        /* ========== MAIN CARD ========== */
        #main-card {
            background: #fff;
            border-radius: 20px;
            padding: 24px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
        }

        #prompt {
            font-size: 20px;
            color: #666;
            text-align: center;
        }

        #problem-display {
            font-size: 48px;
            font-weight: 700;
            color: #333;
            background: linear-gradient(135deg, #ffd93d, #ffb347);
            padding: 16px 48px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(255, 217, 61, 0.4);
        }

        /* ========== VISUAL HELPER - TEN BOXES ========== */
        #visual-helper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 16px;
            background: linear-gradient(180deg, #e8f5e9 0%, #c8e6c9 100%);
            border-radius: 16px;
            border: 3px solid #81c784;
        }

        #tens-grid {
            display: flex;
            flex-direction: column;
            gap: 4px;
            align-items: center;
        }

        .tens-row {
            display: flex;
            gap: 4px;
            align-items: center;
            background: rgba(255,255,255,0.6);
            padding: 3px 6px;
            border-radius: 6px;
        }

        .ten-box {
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, #ef5350, #c62828);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 700;
            color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            border: 1px solid #b71c1c;
        }

        .row-label {
            font-size: 12px;
            font-weight: 600;
            color: #2e7d32;
            min-width: 40px;
            text-align: left;
        }

        #strategy-hint {
            font-size: 16px;
            color: #1b5e20;
            font-weight: 600;
            background: rgba(255,255,255,0.8);
            padding: 10px 16px;
            border-radius: 10px;
            text-align: center;
            line-height: 1.5;
        }

        /* ========== CHOICES ========== */
        #choices {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            width: 100%;
            margin-top: 10px;
        }

        .choice {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 16px;
            padding: 20px 16px;
            font-size: 28px;
            font-weight: 600;
            font-family: 'Fredoka', sans-serif;
            cursor: pointer;
            transition: all 0.15s ease;
            min-height: 70px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .choice:hover {
            transform: scale(1.02);
            filter: brightness(1.1);
        }

        .choice:active {
            transform: scale(0.96);
        }

        .choice.correct {
            background: linear-gradient(135deg, #2ed573, #1abc9c) !important;
            animation: correctPop 0.4s ease;
        }

        .choice.wrong {
            background: linear-gradient(135deg, #E8A838, #F5C563) !important;
            animation: gentleShake 0.4s ease;
        }

        @keyframes correctPop {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.08); }
        }

        @keyframes gentleShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-4px); }
            75% { transform: translateX(4px); }
        }

        /* ========== POPUPS ========== */
        .popup-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.7);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .popup-overlay.show {
            display: flex;
        }

        .popup-content {
            background: white;
            border-radius: 24px;
            padding: 32px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            animation: popIn 0.3s ease;
        }

        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .popup-emoji {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .popup-title {
            font-family: 'Bangers', cursive;
            font-size: 32px;
            color: #333;
            margin-bottom: 8px;
        }

        .popup-subtitle {
            font-size: 16px;
            color: #666;
            margin-bottom: 24px;
        }

        .popup-btn {
            font-family: 'Fredoka', sans-serif;
            font-size: 18px;
            font-weight: 600;
            padding: 14px 32px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: transform 0.1s;
            margin: 5px;
        }

        .popup-btn:hover {
            transform: scale(1.05);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-amber {
            background: linear-gradient(135deg, #E8A838, #F5C563);
            color: white;
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        /* Correct popup styling */
        #correct-popup .popup-content {
            border: 4px solid #2ed573;
        }

        #correct-popup .popup-title {
            color: #333;
            font-size: 64px;
        }

        .correct-answer-box {
            font-size: 48px;
            font-weight: 700;
            color: #2ed573;
            background: #e8f8f0;
            padding: 16px 32px;
            border-radius: 16px;
            margin: 16px 0;
        }

        /* Wrong popup styling */
        #wrong-popup .popup-content {
            border: 4px solid #E8A838;
        }

        #wrong-popup .popup-title {
            color: #D4882A;
            font-size: 24px;
            line-height: 1.3;
        }

        #correct-answer-area {
            display: none;
            margin: 16px 0;
            padding: 16px;
            background: #f0f8ff;
            border-radius: 12px;
        }

        #correct-answer-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
        }

        #correct-answer-display {
            font-size: 20px;
            font-weight: 700;
            color: #2ed573;
            line-height: 1.5;
        }

        /* Streak popup styling */
        #streak-popup .popup-content {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        #streak-popup .popup-title,
        #streak-popup .popup-subtitle {
            color: white;
        }

        .streak-number {
            font-family: 'Bangers', cursive;
            font-size: 72px;
            color: #ffd93d;
            text-shadow: 3px 3px 0 rgba(0,0,0,0.2);
        }

        .streak-hype {
            font-size: 18px;
            color: white;
            font-weight: 600;
            background: rgba(255,255,255,0.2);
            padding: 12px 20px;
            border-radius: 12px;
            margin-top: 12px;
        }

        /* ========== START SCREEN ========== */
        #start-screen {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            text-align: center;
            padding: 20px;
            overflow-y: auto;
        }

        #start-screen.hidden { display: none; }

        #start-title {
            font-family: 'Bangers', cursive;
            font-size: 48px;
            color: white;
            margin-bottom: 12px;
        }

        #start-subtitle {
            font-size: 20px;
            color: rgba(255,255,255,0.9);
            margin-bottom: 20px;
            max-width: 400px;
        }

        /* Demo visual on start screen */
        #start-demo {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 20px 24px;
            margin-bottom: 24px;
            text-align: center;
            max-width: 400px;
        }

        #demo-problem {
            font-size: 28px;
            font-weight: 700;
            color: #333;
            margin-bottom: 12px;
        }

        #demo-grid {
            display: flex;
            flex-direction: column;
            gap: 6px;
            align-items: center;
            background: linear-gradient(180deg, #e8f5e9 0%, #c8e6c9 100%);
            padding: 12px;
            border-radius: 12px;
            border: 3px solid #81c784;
            margin-bottom: 12px;
        }

        .demo-row {
            display: flex;
            gap: 8px;
            align-items: center;
            background: rgba(255,255,255,0.6);
            padding: 4px 8px;
            border-radius: 6px;
        }

        .demo-row .ten-box {
            width: 32px;
            height: 32px;
            font-size: 12px;
        }

        .demo-row-label {
            font-size: 12px;
            font-weight: 600;
            color: #2e7d32;
            min-width: 40px;
        }

        #demo-breakdown {
            font-size: 18px;
            color: #1b5e20;
            font-weight: 600;
            line-height: 1.6;
        }

        #start-btn {
            font-family: 'Bangers', cursive;
            font-size: 32px;
            padding: 16px 48px;
            background: #ffd93d;
            color: #333;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            transition: transform 0.1s;
        }

        #start-btn:hover {
            transform: scale(1.05);
        }

        /* ========== END SCREEN ========== */
        #end-screen {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            text-align: center;
            padding: 20px;
        }

        #end-screen.show { display: flex; }

        #end-emoji { font-size: 80px; margin-bottom: 16px; }

        #end-title {
            font-family: 'Bangers', cursive;
            font-size: 42px;
            color: white;
            margin-bottom: 8px;
        }

        #end-subtitle {
            font-size: 20px;
            color: rgba(255,255,255,0.9);
            margin-bottom: 24px;
        }

        #end-stats {
            font-size: 18px;
            color: rgba(255,255,255,0.8);
            margin-bottom: 32px;
        }

        #play-again-btn {
            font-family: 'Bangers', cursive;
            font-size: 28px;
            padding: 14px 40px;
            background: #ffd93d;
            color: #333;
            border: none;
            border-radius: 16px;
            cursor: pointer;
        }

        /* ========== EFFECTS ========== */
        .confetti {
            position: fixed;
            top: -10px;
            z-index: 3000;
            animation: confettiFall 2s ease forwards;
            pointer-events: none;
        }

        @keyframes confettiFall {
            to { top: 110vh; transform: rotate(720deg); }
        }

        .flying-emoji-correct {
            position: fixed;
            font-size: 50px;
            pointer-events: none;
            z-index: 3000;
            animation: flyUpCorrect 1.2s ease-out forwards;
        }

        .flying-emoji-correct.streak-mid { font-size: 65px; }
        .flying-emoji-correct.streak-high { font-size: 80px; }
        .flying-emoji-correct.streak-ultra { font-size: 100px; }

        @keyframes flyUpCorrect {
            0% { transform: scale(0) translateY(0); opacity: 1; }
            30% { transform: scale(1.3) translateY(-100px); opacity: 1; }
            100% { transform: scale(1) translateY(-500px); opacity: 0; }
        }

        /* ========== MOBILE ========== */
        @media (max-width: 480px) {
            #title { font-size: 18px; }
            .stat-value { font-size: 18px; }
            #problem-display { font-size: 32px; padding: 12px 24px; }
            #prompt { font-size: 16px; }
            .choice { font-size: 22px; min-height: 60px; padding: 12px; }
            #start-title { font-size: 36px; }
            #end-title { font-size: 32px; }
            #demo-problem { font-size: 22px; }
            #demo-breakdown { font-size: 14px; }
            .ten-box { width: 28px; height: 28px; font-size: 11px; }
            .demo-row .ten-box { width: 24px; height: 24px; font-size: 10px; }
            #strategy-hint { font-size: 14px; padding: 8px 12px; }
            .row-label { font-size: 12px; min-width: 40px; }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <!-- ========== START SCREEN ========== -->
        <div id="start-screen">
            <div id="start-title">üîü Tens Takeover!</div>
            <div id="start-subtitle">Multiply by thinking in groups of 10!</div>
            
            <div id="start-demo">
                <div id="demo-problem">4 √ó 30 = ?</div>
                <div id="demo-grid">
                    <!-- 4 rows of 3 ten-boxes = 4 groups of 3 tens -->
                    <div class="demo-row">
                        <div class="ten-box">10</div>
                        <div class="ten-box">10</div>
                        <div class="ten-box">10</div>
                        <div class="demo-row-label">= 30</div>
                    </div>
                    <div class="demo-row">
                        <div class="ten-box">10</div>
                        <div class="ten-box">10</div>
                        <div class="ten-box">10</div>
                        <div class="demo-row-label">= 30</div>
                    </div>
                    <div class="demo-row">
                        <div class="ten-box">10</div>
                        <div class="ten-box">10</div>
                        <div class="ten-box">10</div>
                        <div class="demo-row-label">= 30</div>
                    </div>
                    <div class="demo-row">
                        <div class="ten-box">10</div>
                        <div class="ten-box">10</div>
                        <div class="ten-box">10</div>
                        <div class="demo-row-label">= 30</div>
                    </div>
                </div>
                <div id="demo-breakdown">
                    4 groups of 3 tens<br>
                    4 √ó 3 = 12<br>
                    12 tens = <strong>120</strong>
                </div>
            </div>
            
            <button id="start-btn">Let's Go! üöÄ</button>
        </div>

        <!-- ========== HEADER ========== -->
        <div id="header">
            <div id="title">üîü Tens Takeover!</div>
            <div id="stats">
                <div class="stat">
                    <div class="stat-label">Score</div>
                    <div class="stat-value" id="score">0</div>
                </div>
                <div class="stat streak-display" id="streak-display">
                    <div class="stat-label">Streak</div>
                    <div class="stat-value" id="streak">0 üî•</div>
                </div>
                <div class="stat" id="difficulty-display">
                    <div class="stat-label">Level</div>
                    <div class="stat-value" id="difficulty-level">üå±</div>
                </div>
            </div>
        </div>

        <!-- ========== MAIN CARD ========== -->
        <div id="main-card">
            <div id="prompt">How many in all?</div>
            
            <div id="problem-display">3 √ó 40 = ?</div>
            
            <div id="visual-helper">
                <div id="tens-grid"></div>
                <div id="strategy-hint"></div>
            </div>
            
            <div id="choices"></div>
        </div>

        <!-- ========== CORRECT POPUP ========== -->
        <div class="popup-overlay" id="correct-popup">
            <div class="popup-content">
                <div class="popup-emoji" id="correct-emoji">‚≠ê</div>
                <div class="popup-title" id="correct-title">Nice!</div>
                <div class="correct-answer-box">
                    <span id="correct-answer-text"></span> ‚úì
                </div>
                <button class="popup-btn btn-primary" id="correct-next-btn">Next ‚Üí</button>
            </div>
        </div>

        <!-- ========== WRONG POPUP ========== -->
        <div class="popup-overlay" id="wrong-popup">
            <div class="popup-content">
                <div class="popup-emoji" id="wrong-emoji">ü§î</div>
                <div class="popup-title" id="wrong-title">Mistakes in math are OK!</div>
                <div class="popup-subtitle" id="wrong-subtitle"></div>
                
                <div id="correct-answer-area">
                    <div id="correct-answer-label">Here's how it works:</div>
                    <div id="correct-answer-display"></div>
                </div>
                
                <div>
                    <button class="popup-btn btn-amber" id="try-again-btn">Try Again üîÑ</button>
                    <button class="popup-btn btn-secondary" id="show-answer-btn">Show Answer üëÄ</button>
                </div>
            </div>
        </div>

        <!-- ========== STREAK POPUP ========== -->
        <div class="popup-overlay" id="streak-popup">
            <div class="popup-content">
                <div class="popup-emoji">üî•</div>
                <div class="popup-title">STREAK!</div>
                <div class="streak-number" id="streak-count">3</div>
                <div class="streak-hype" id="streak-hype">On fire!</div>
                <button class="popup-btn btn-primary" id="streak-continue-btn">Keep Going! üí™</button>
            </div>
        </div>

        <!-- ========== END SCREEN ========== -->
        <div id="end-screen">
            <div id="end-emoji">üéì</div>
            <div id="end-title">You're a Mathematician!</div>
            <div id="end-subtitle">You mastered those tens!</div>
            <div id="end-stats">Score: <span id="final-score">0</span> | Best Streak: <span id="best-streak">0</span></div>
            <button id="play-again-btn">Play Again üîÑ</button>
        </div>
    </div>

    <script>
        // ========== AUDIO ==========
        let audioCtx = null;
        
        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function playSound(type) {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            if (type === 'correct') {
                osc.type = 'square';
                osc.frequency.setValueAtTime(523, audioCtx.currentTime);
                osc.frequency.setValueAtTime(659, audioCtx.currentTime + 0.08);
                osc.frequency.setValueAtTime(784, audioCtx.currentTime + 0.16);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.3);
                osc.start(); osc.stop(audioCtx.currentTime + 0.3);
            } else if (type === 'wrong') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(200, audioCtx.currentTime);
                osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.3);
                osc.start(); osc.stop(audioCtx.currentTime + 0.3);
            } else if (type === 'streak') {
                osc.type = 'square';
                osc.frequency.setValueAtTime(523, audioCtx.currentTime);
                osc.frequency.setValueAtTime(659, audioCtx.currentTime + 0.1);
                osc.frequency.setValueAtTime(784, audioCtx.currentTime + 0.2);
                osc.frequency.setValueAtTime(1047, audioCtx.currentTime + 0.3);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.5);
                osc.start(); osc.stop(audioCtx.currentTime + 0.5);
            } else if (type === 'complete') {
                osc.type = 'square';
                osc.frequency.setValueAtTime(523, audioCtx.currentTime);
                osc.frequency.setValueAtTime(659, audioCtx.currentTime + 0.12);
                osc.frequency.setValueAtTime(784, audioCtx.currentTime + 0.24);
                osc.frequency.setValueAtTime(1047, audioCtx.currentTime + 0.36);
                gain.gain.setValueAtTime(0.12, audioCtx.currentTime);
                gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.6);
                osc.start(); osc.stop(audioCtx.currentTime + 0.6);
            }
        }

        // ========== EFFECTS ==========
        function spawnConfetti(count) {
            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    const c = document.createElement('div');
                    c.className = 'confetti';
                    c.style.left = Math.random() * 100 + 'vw';
                    c.style.width = c.style.height = (6 + Math.random() * 8) + 'px';
                    c.style.background = ['#ff6b6b','#ffd93d','#6bcb77','#4d96ff','#ff9ff3','#a55eea'][Math.floor(Math.random()*6)];
                    c.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                    document.body.appendChild(c);
                    setTimeout(() => c.remove(), 2000);
                }, i * 30);
            }
        }

        function spawnCorrectEmojis(count, streakLevel) {
            const emojis = ['‚≠ê', '‚ú®', 'üí´', 'üåü', 'üí•', 'üî•', 'üí™', 'üéØ', 'üöÄ', 'üëë', 'üíé', 'üîü'];
            let sizeClass = '';
            if (streakLevel >= 10) sizeClass = 'streak-ultra';
            else if (streakLevel >= 6) sizeClass = 'streak-high';
            else if (streakLevel >= 3) sizeClass = 'streak-mid';
            
            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    const emoji = document.createElement('div');
                    emoji.className = 'flying-emoji-correct' + (sizeClass ? ' ' + sizeClass : '');
                    emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    emoji.style.left = (10 + Math.random() * 80) + '%';
                    emoji.style.top = (50 + Math.random() * 30) + '%';
                    document.body.appendChild(emoji);
                    setTimeout(() => emoji.remove(), 1500);
                }, i * 50);
            }
        }

        // ==========================================================================
        // MESSAGE ARRAYS - DO NOT MODIFY
        // ==========================================================================
        
        // Mr. Signer's growth mindset board - ONLY for WRONG answers
        const growthMessages = [
            "Mistakes in math are OK!",
            "The process is more important than the answer!",
            "Math is hard, but I can do it!",
            "There's ALWAYS more than one way to solve it!",
            "I can learn anything in math!",
            "I believe I can be good at math!",
            "If I don't get it the first time, I can try a new way!",
            "Math helps me build my brain and become a thinker!"
        ];

        // Wrong answer popup emojis
        const wrongEmojis = ['ü§î', 'üí≠', 'üß†', 'üí™'];

        // Hype messages - ONLY for CORRECT answers (2026 Gen Alpha slang)
        const correctHypeMessages = [
            "W!",
            "Huge W!",
            "Slay!",
            "Goated!",
            "Fire!",
            "Slaps!",
            "No cap!",
            "Valid!",
            "Let's go!",
            "Sigma!"
        ];

        // Streak hype messages - for streak celebrations
        const streakHypeMessages = [
            { streak: 3, hype: "Straight fire!" },
            { streak: 6, hype: "Goated!" },
            { streak: 9, hype: "We are all MATHEMATICIANS!" },
            { streak: 12, hype: "SIGMA BRAIN!" }
        ];

        // ==========================================================================
        // GAME STATE
        // ==========================================================================
        const TOTAL_QUESTIONS = 15;
        let score = 0;
        let streak = 0;
        let bestStreak = 0;
        let questionsAnswered = 0;
        let currentProblem = null;
        let canAnswer = true;
        
        // Difficulty levels: 'easy', 'hard', 'superhard'
        // Once unlocked, difficulty never goes back down
        let currentDifficulty = 'easy';
        let unlockedHard = false;
        let unlockedSuperHard = false;

        // ==========================================================================
        // DOM ELEMENTS
        // ==========================================================================
        const startScreen = document.getElementById('start-screen');
        const startBtn = document.getElementById('start-btn');
        const endScreen = document.getElementById('end-screen');
        const playAgainBtn = document.getElementById('play-again-btn');
        const scoreEl = document.getElementById('score');
        const streakEl = document.getElementById('streak');
        const streakDisplay = document.getElementById('streak-display');
        const difficultyDisplay = document.getElementById('difficulty-display');
        const difficultyLevel = document.getElementById('difficulty-level');
        const choicesContainer = document.getElementById('choices');
        const problemDisplay = document.getElementById('problem-display');
        const tensGrid = document.getElementById('tens-grid');
        const strategyHint = document.getElementById('strategy-hint');

        // ==========================================================================
        // ML 4.11: PROBLEM GENERATION (with difficulty levels)
        // One-digit √ó Multiple of 10
        // ==========================================================================
        
        // Calculate how many "beyond super hard" levels we've unlocked
        function getBeyondSuperHardLevel() {
            if (bestStreak < 15) return 0;
            return Math.floor((bestStreak - 12) / 3);  // 15->1, 18->2, 21->3, etc.
        }
        
        // Update the difficulty display in the UI
        function updateDifficultyDisplay(leveledUp = false) {
            if (currentDifficulty === 'easy') {
                difficultyLevel.textContent = 'üå±';
                difficultyDisplay.className = 'stat';
                difficultyDisplay.id = 'difficulty-display';
            } else if (currentDifficulty === 'hard') {
                difficultyLevel.textContent = 'üî•';
                difficultyDisplay.className = 'stat hard';
                difficultyDisplay.id = 'difficulty-display';
            } else {
                // Super hard and beyond - show level number if beyond base super hard
                const beyondLevel = getBeyondSuperHardLevel();
                if (beyondLevel === 0) {
                    difficultyLevel.textContent = 'üíÄ';
                } else {
                    difficultyLevel.textContent = 'üíÄ' + beyondLevel;
                }
                difficultyDisplay.className = 'stat superhard';
                difficultyDisplay.id = 'difficulty-display';
            }
            
            if (leveledUp) {
                difficultyDisplay.classList.add('level-up');
                setTimeout(() => difficultyDisplay.classList.remove('level-up'), 500);
            }
        }
        
        // Check and update difficulty based on best streak achieved
        function updateDifficulty() {
            if (bestStreak >= 12 && !unlockedSuperHard) {
                unlockedSuperHard = true;
                currentDifficulty = 'superhard';
                updateDifficultyDisplay(true);
            } else if (bestStreak >= 4 && !unlockedHard) {
                unlockedHard = true;
                currentDifficulty = 'hard';
                updateDifficultyDisplay(true);
            }
        }
        
        function generateProblem() {
            // Update difficulty before generating
            updateDifficulty();
            
            let a, tens;
            
            if (currentDifficulty === 'easy') {
                // Easy: first factor 2-6, tens 1-5 (multiples 10-50)
                a = 2 + Math.floor(Math.random() * 5);  // 2, 3, 4, 5, 6
                tens = 1 + Math.floor(Math.random() * 5);  // 1, 2, 3, 4, 5
            } else if (currentDifficulty === 'hard') {
                // Hard: first factor 2-9, tens 1-9 (multiples 10-90)
                a = 2 + Math.floor(Math.random() * 8);  // 2-9
                tens = 1 + Math.floor(Math.random() * 9);  // 1-9
            } else {
                // Super Hard and beyond: first factor scales up every 3 streaks after 12
                const beyondLevel = getBeyondSuperHardLevel();
                const minFactor = 10 + (beyondLevel * 3);  // 10, 13, 16, 19, ...
                const maxFactor = 15 + (beyondLevel * 3);  // 15, 18, 21, 24, ...
                a = minFactor + Math.floor(Math.random() * 6);  // always 6 options
                tens = 1 + Math.floor(Math.random() * 9);  // 1-9
                
                // Update display if we leveled up beyond super hard
                if (beyondLevel > 0) {
                    updateDifficultyDisplay(false);
                }
            }
            
            const b = tens * 10;
            
            // The strategy: a √ó b = a groups of `tens` tens = (a √ó tens) tens
            const product = a * b;
            const totalTens = a * tens;
            
            return {
                display: `${a} √ó ${b} = ?`,
                answer: product,
                a: a,           // number of rows/groups
                b: b,           // multiple of 10
                tens: tens,     // tens per row
                totalTens: totalTens
            };
        }

        // ==========================================================================
        // CHOICE GENERATION - Plausible wrong answers
        // ==========================================================================
        function generateChoices(problem) {
            const correct = { display: problem.answer, isCorrect: true };
            const wrongs = [];
            const usedAnswers = new Set([problem.answer]);
            
            // Common mistake types:
            const wrongTypes = [
                problem.totalTens,              // Forgot √ó10, just counted tens
                problem.answer + 10,            // Off by one ten
                problem.answer - 10,
                (problem.totalTens + 1) * 10,   // Miscounted tens by 1
                (problem.totalTens - 1) * 10,
                problem.answer + 100,           // Place value error
                problem.answer - 100,
                problem.a * problem.tens,       // Just multiplied digits
            ];
            
            // Shuffle and pick unique wrong answers
            for (let i = wrongTypes.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [wrongTypes[i], wrongTypes[j]] = [wrongTypes[j], wrongTypes[i]];
            }
            
            for (const wrongAnswer of wrongTypes) {
                if (wrongs.length >= 3) break;
                if (wrongAnswer > 0 && !usedAnswers.has(wrongAnswer)) {
                    wrongs.push({ display: wrongAnswer, isCorrect: false });
                    usedAnswers.add(wrongAnswer);
                }
            }
            
            // Fill remaining if needed
            while (wrongs.length < 3) {
                const wrongAnswer = problem.answer + (Math.floor(Math.random() * 10) - 5) * 10;
                if (wrongAnswer > 0 && !usedAnswers.has(wrongAnswer)) {
                    wrongs.push({ display: wrongAnswer, isCorrect: false });
                    usedAnswers.add(wrongAnswer);
                }
            }
            
            // Shuffle all choices
            const choices = [correct, ...wrongs];
            for (let i = choices.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [choices[i], choices[j]] = [choices[j], choices[i]];
            }
            return choices;
        }

        // ==========================================================================
        // BUILD VISUAL: Rows of "10" boxes (like Amplify curriculum)
        // ==========================================================================
        function buildVisual(problem) {
            const visualHelper = document.getElementById('visual-helper');
            
            // After 15 streak, hide visual to make it harder (pure mental math)
            if (bestStreak >= 15) {
                visualHelper.style.display = 'none';
                return;
            }
            
            // Show visual helper
            visualHelper.style.display = 'flex';
            tensGrid.innerHTML = '';
            
            // Show ALL rows - students need to see the complete visual
            for (let row = 0; row < problem.a; row++) {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'tens-row';
                
                // Add ten boxes
                for (let t = 0; t < problem.tens; t++) {
                    const tenBox = document.createElement('div');
                    tenBox.className = 'ten-box';
                    tenBox.textContent = '10';
                    rowDiv.appendChild(tenBox);
                }
                
                // Add row label
                const label = document.createElement('div');
                label.className = 'row-label';
                label.textContent = `= ${problem.b}`;
                rowDiv.appendChild(label);
                
                tensGrid.appendChild(rowDiv);
            }
            
            // Strategy hint - just state what they see, no extra question
            strategyHint.innerHTML = `${problem.a} rows √ó ${problem.tens} tens`;
        }

        // ==========================================================================
        // DISPLAY CORRECT ANSWER in wrong popup
        // ==========================================================================
        function buildCorrectAnswerDisplay() {
            const p = currentProblem;
            document.getElementById('correct-answer-display').innerHTML = 
                `${p.a} groups of ${p.tens} tens<br>` +
                `${p.a} √ó ${p.tens} = ${p.totalTens} tens<br>` +
                `${p.totalTens} tens = <strong>${p.answer}</strong>`;
        }

        // ==========================================================================
        // LOAD PROBLEM
        // ==========================================================================
        function loadProblem() {
            currentProblem = generateProblem();
            const choices = generateChoices(currentProblem);
            
            // Update display
            problemDisplay.textContent = currentProblem.display;
            buildVisual(currentProblem);
            
            // Update choices
            choicesContainer.innerHTML = '';
            choices.forEach(choice => {
                const btn = document.createElement('button');
                btn.className = 'choice';
                btn.textContent = choice.display;
                btn.addEventListener('click', () => handleChoice(btn, choice));
                choicesContainer.appendChild(btn);
            });
            
            canAnswer = true;
        }

        // ==========================================================================
        // HANDLE CHOICE
        // ==========================================================================
        function handleChoice(btn, choice) {
            if (!canAnswer) return;
            canAnswer = false;
            initAudio();

            if (choice.isCorrect) {
                btn.classList.add('correct');
                playSound('correct');
                score++;
                streak++;
                if (streak > bestStreak) bestStreak = streak;
                
                scoreEl.textContent = score;
                streakEl.textContent = streak + ' üî•';
                
                if (streak >= 3) {
                    streakDisplay.classList.add('hot');
                }

                let emojiCount = streak >= 10 ? 25 : streak >= 6 ? 18 : streak >= 3 ? 12 : 6;
                spawnCorrectEmojis(emojiCount, streak);
                
                if (streak >= 3) spawnConfetti(streak >= 10 ? 30 : streak >= 6 ? 20 : 10);

                questionsAnswered++;

                // Show correct popup with affirming message
                setTimeout(() => {
                    showCorrectPopup();
                }, 400);
            } else {
                btn.classList.add('wrong');
                playSound('wrong');
                streak = 0;
                streakEl.textContent = '0 üî•';
                streakDisplay.classList.remove('hot');
                
                setTimeout(() => showWrongPopup(), 400);
            }
        }

        // ==========================================================================
        // POPUPS
        // ==========================================================================
        function showCorrectPopup() {
            // Pick hype message - 2026 Gen Alpha slang (UPPERCASE for visibility)
            const hypeMessages = [
                { emoji: 'üß¢', title: 'NO CAP!' },
                { emoji: 'üî•', title: 'FIRE!' },
                { emoji: 'üí™', title: 'W!' },
                { emoji: 'üëë', title: 'SLAY!' },
                { emoji: '‚ú®', title: 'VALID!' },
                { emoji: 'üéØ', title: 'GOATED!' },
                { emoji: 'üí•', title: 'SLAPS!' },
                { emoji: 'üöÄ', title: 'LET\'S GO!' }
            ];
            const msg = hypeMessages[Math.floor(Math.random() * hypeMessages.length)];
            
            document.getElementById('correct-emoji').textContent = msg.emoji;
            document.getElementById('correct-title').textContent = msg.title;
            document.getElementById('correct-answer-text').textContent = currentProblem.answer;
            
            document.getElementById('correct-popup').classList.add('show');
        }

        function showWrongPopup() {
            // Random emoji
            document.getElementById('wrong-emoji').textContent = 
                wrongEmojis[Math.floor(Math.random() * wrongEmojis.length)];
            
            // ONE message only - growth mindset from Mr. Signer's board
            const message = growthMessages[Math.floor(Math.random() * growthMessages.length)];
            document.getElementById('wrong-title').textContent = message;
            document.getElementById('wrong-subtitle').textContent = '';
            
            document.getElementById('correct-answer-area').style.display = 'none';
            document.getElementById('try-again-btn').style.display = 'inline-block';
            document.getElementById('show-answer-btn').textContent = 'Show Answer üëÄ';
            document.getElementById('wrong-popup').classList.add('show');
        }

        function showStreakCelebration() {
            playSound('streak');
            document.getElementById('streak-count').textContent = streak;
            
            let hypeMsg = "Straight fire!";
            for (const s of streakHypeMessages) {
                if (streak >= s.streak) hypeMsg = s.hype;
            }
            document.getElementById('streak-hype').textContent = hypeMsg;
            
            // EPIC celebration ONLY at exactly streak 15 (and only once per game)
            if (streak === 15 && !epicCelebrationShown) {
                epicCelebrationShown = true;
                triggerEpicMathematiciansCelebration();
            } else {
                // Regular streak popup for 3, 6, 12, 15, etc.
                document.getElementById('streak-popup').classList.add('show');
                spawnConfetti(25);
                spawnCorrectEmojis(20, streak);
            }
        }

        // Track epic celebration timer so we can cancel it
        let epicTimer = null;
        
        // Track if "We are all Mathematicians" has been shown (only show once per game)
        let epicCelebrationShown = false;

        // EPIC "We are all MATHEMATICIANS!" celebration for streak 15 (once per game)
        function triggerEpicMathematiciansCelebration() {
            // Create epic overlay
            const epicOverlay = document.createElement('div');
            epicOverlay.id = 'epic-mathematicians';
            epicOverlay.innerHTML = `
                <div class="epic-content">
                    <div class="epic-emoji-burst" id="epic-burst"></div>
                    <div class="epic-text">
                        <div class="epic-we">WE ARE ALL</div>
                        <div class="epic-math">MATHEMATICIANS!</div>
                        <div class="epic-streak">${streak} STREAK! üî•</div>
                    </div>
                    <button class="epic-btn" onclick="closeEpicCelebration()">LET'S GOOO! üöÄ</button>
                </div>
            `;
            epicOverlay.style.cssText = `
                position: fixed;
                top: 0; left: 0; right: 0; bottom: 0;
                background: linear-gradient(135deg, #667eea, #764ba2, #f39c12, #e74c3c);
                background-size: 400% 400%;
                animation: epicGradient 2s ease infinite;
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                overflow: hidden;
            `;
            document.body.appendChild(epicOverlay);
            
            // Add styles
            const style = document.createElement('style');
            style.textContent = `
                @keyframes epicGradient {
                    0% { background-position: 0% 50%; }
                    50% { background-position: 100% 50%; }
                    100% { background-position: 0% 50%; }
                }
                @keyframes epicShake {
                    0%, 100% { transform: translateX(0) rotate(0); }
                    25% { transform: translateX(-10px) rotate(-2deg); }
                    75% { transform: translateX(10px) rotate(2deg); }
                }
                @keyframes epicPulse {
                    0%, 100% { transform: scale(1); }
                    50% { transform: scale(1.1); }
                }
                @keyframes epicFloat {
                    0% { transform: translateY(100vh) rotate(0deg); opacity: 1; }
                    100% { transform: translateY(-100vh) rotate(720deg); opacity: 0; }
                }
                @keyframes rainbowText {
                    0% { color: #ff6b6b; text-shadow: 0 0 20px #ff6b6b; }
                    25% { color: #ffd93d; text-shadow: 0 0 20px #ffd93d; }
                    50% { color: #6bcb77; text-shadow: 0 0 20px #6bcb77; }
                    75% { color: #4d96ff; text-shadow: 0 0 20px #4d96ff; }
                    100% { color: #ff6b6b; text-shadow: 0 0 20px #ff6b6b; }
                }
                .epic-content {
                    text-align: center;
                    animation: epicShake 0.5s ease infinite;
                }
                .epic-text { margin: 20px 0; }
                .epic-we {
                    font-family: 'Bangers', cursive;
                    font-size: 36px;
                    color: white;
                    text-shadow: 3px 3px 0 rgba(0,0,0,0.3);
                }
                .epic-math {
                    font-family: 'Bangers', cursive;
                    font-size: 52px;
                    animation: rainbowText 1s linear infinite, epicPulse 0.5s ease infinite;
                    text-shadow: 4px 4px 0 rgba(0,0,0,0.3);
                }
                .epic-streak {
                    font-family: 'Bangers', cursive;
                    font-size: 28px;
                    color: #ffd93d;
                    margin-top: 10px;
                }
                .epic-btn {
                    font-family: 'Bangers', cursive;
                    font-size: 28px;
                    padding: 16px 40px;
                    background: #ffd93d;
                    color: #333;
                    border: none;
                    border-radius: 16px;
                    cursor: pointer;
                    margin-top: 20px;
                    animation: epicPulse 0.5s ease infinite;
                }
                .epic-floating-emoji {
                    position: fixed;
                    font-size: 60px;
                    animation: epicFloat 3s linear forwards;
                    pointer-events: none;
                }
            `;
            document.head.appendChild(style);
            
            // Spawn MASSIVE emoji explosion (60 emojis)
            const epicEmojis = ['üßÆ', 'üéì', 'üß†', 'üíØ', '‚≠ê', '‚ú®', 'üåü', 'üí´', 'üî•', 'üëë', 'üèÜ', 'üíé', 'üöÄ', 'üéØ', 'ü¶æ', 'ü§ì', 'üìê', 'üìè', '‚ûï', '‚ûñ', '‚úñÔ∏è', '‚ûó', 'üîü'];
            for (let i = 0; i < 60; i++) {
                setTimeout(() => {
                    const epicEl = document.getElementById('epic-mathematicians');
                    if (!epicEl) return; // Already closed, skip
                    const emoji = document.createElement('div');
                    emoji.className = 'epic-floating-emoji';
                    emoji.textContent = epicEmojis[Math.floor(Math.random() * epicEmojis.length)];
                    emoji.style.left = Math.random() * 100 + 'vw';
                    emoji.style.fontSize = (40 + Math.random() * 60) + 'px';
                    emoji.style.animationDuration = (2 + Math.random() * 2) + 's';
                    epicEl.appendChild(emoji);
                }, i * 50);
            }
            
            // Rainbow confetti blast
            for (let i = 0; i < 100; i++) {
                setTimeout(() => {
                    const conf = document.createElement('div');
                    conf.style.cssText = `
                        position: fixed;
                        top: -10px;
                        left: ${Math.random() * 100}vw;
                        width: ${8 + Math.random() * 12}px;
                        height: ${8 + Math.random() * 12}px;
                        background: ${['#ff6b6b','#ffd93d','#6bcb77','#4d96ff','#ff9ff3','#a55eea','#ff85a2','#54e3ff'][Math.floor(Math.random()*8)]};
                        border-radius: ${Math.random() > 0.5 ? '50%' : '0'};
                        animation: confettiFall ${2 + Math.random()}s linear forwards;
                        z-index: 10001;
                    `;
                    document.body.appendChild(conf);
                    setTimeout(() => conf.remove(), 3000);
                }, i * 20);
            }
            
            // Auto-continue after 10 seconds (or user can click button)
            epicTimer = setTimeout(() => {
                closeEpicCelebration();
            }, 10000);
        }

        // Close epic celebration and CONTINUE playing
        function closeEpicCelebration() {
            // Clear timer if user clicked button early
            if (epicTimer) {
                clearTimeout(epicTimer);
                epicTimer = null;
            }
            const epic = document.getElementById('epic-mathematicians');
            if (epic) epic.remove();
            loadProblem(); // Keep playing!
        }

        function showEndScreen() {
            playSound('complete');
            document.getElementById('final-score').textContent = score;
            document.getElementById('best-streak').textContent = bestStreak;
            endScreen.classList.add('show');
            spawnConfetti(50);
        }

        function checkGameEnd() {
            // Game is endless - player decides when to stop
            loadProblem();
        }

        // ==========================================================================
        // EVENT HANDLERS
        // ==========================================================================
        document.getElementById('correct-next-btn').addEventListener('click', () => {
            document.getElementById('correct-popup').classList.remove('show');
            // Check for streak celebration or continue
            if (streak > 0 && streak % 3 === 0) {
                showStreakCelebration();
            } else {
                checkGameEnd();
            }
        });

        document.getElementById('try-again-btn').addEventListener('click', () => {
            document.getElementById('wrong-popup').classList.remove('show');
            document.querySelectorAll('.choice.wrong').forEach(el => el.classList.remove('wrong'));
            canAnswer = true;
        });

        document.getElementById('show-answer-btn').addEventListener('click', () => {
            buildCorrectAnswerDisplay();
            document.getElementById('correct-answer-area').style.display = 'block';
            document.getElementById('try-again-btn').style.display = 'none';
            document.getElementById('show-answer-btn').textContent = 'Next Question ‚Üí';
            document.getElementById('show-answer-btn').onclick = () => {
                document.getElementById('wrong-popup').classList.remove('show');
                document.getElementById('show-answer-btn').textContent = 'Show Answer üëÄ';
                document.getElementById('correct-answer-area').style.display = 'none';
                document.getElementById('try-again-btn').style.display = 'inline-block';
                document.getElementById('show-answer-btn').onclick = null;
                questionsAnswered++;
                checkGameEnd();
            };
        });

        document.getElementById('streak-continue-btn').addEventListener('click', () => {
            document.getElementById('streak-popup').classList.remove('show');
            checkGameEnd();
        });

        // ==========================================================================
        // START / RESTART
        // ==========================================================================
        function startGame() {
            score = 0;
            streak = 0;
            bestStreak = 0;
            questionsAnswered = 0;
            epicCelebrationShown = false; // Reset so celebration can show again in new game
            currentDifficulty = 'easy';   // Reset difficulty
            unlockedHard = false;
            unlockedSuperHard = false;
            scoreEl.textContent = '0';
            streakEl.textContent = '0 üî•';
            streakDisplay.classList.remove('hot');
            updateDifficultyDisplay();    // Reset difficulty display
            document.getElementById('visual-helper').style.display = 'flex'; // Reset visual
            startScreen.classList.add('hidden');
            endScreen.classList.remove('show');
            loadProblem();
        }

        startBtn.addEventListener('click', () => { initAudio(); startGame(); });
        playAgainBtn.addEventListener('click', () => { startGame(); });
    </script>
</body>
</html>
